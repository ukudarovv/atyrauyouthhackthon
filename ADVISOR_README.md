# ü§ñ AI –°–æ–≤–µ—Ç—á–∏–∫ - –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è POS —Å–∏—Å—Ç–µ–º—ã

## üìã –û–±–∑–æ—Ä

AI –°–æ–≤–µ—Ç—á–∏–∫ - —ç—Ç–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —á–∞—Ç-–±–æ—Ç –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –±–∏–∑–Ω–µ—Å–∞. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã **–±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LLM** –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã, –∏—Å–ø–æ–ª—å–∑—É—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ –ø—Ä—è–º—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–±–µ–∑ LLM)
- **–ù–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã**: "–°–∫–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤?"
- **–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤**: "–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ?"
- **–í—ã–¥–∞—á–∞ –∫—É–ø–æ–Ω–æ–≤**: "–°–∫–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è –≤—ã–¥–∞–Ω–æ –∫—É–ø–æ–Ω–æ–≤?"
- **–ü–æ–≥–∞—à–µ–Ω–∏—è**: "–°–∫–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è –ø–æ–≥–∞—à–µ–Ω–∏–π?"
- **–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏**: "–°–∫–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π?"
- **Conversion Rate**: "CR —Å–µ–≥–æ–¥–Ω—è?"

### üìÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–∏–æ–¥–æ–≤
- `—Å–µ–≥–æ–¥–Ω—è`, `–≤—á–µ—Ä–∞`
- `—ç—Ç–∞ –Ω–µ–¥–µ–ª—è`, `—ç—Ç–æ—Ç –º–µ—Å—è—Ü`
- `–∑–∞ –Ω–µ–¥–µ–ª—é`, `–∑–∞ –º–µ—Å—è—Ü`

### üéØ –£–º–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
- **–°–∏–Ω–æ–Ω–∏–º—ã**: —Å–∫–æ–ª—å–∫–æ/–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∫–ª–∏–µ–Ω—Ç—ã/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏/—é–∑–µ—Ä—ã
- **–í–∞—Ä–∏–∞—Ü–∏–∏**: –Ω–æ–≤—ã—Ö/–ø—Ä–∏—à–µ–¥—à–∏—Ö, –ø–æ–≥–∞—à–µ–Ω–æ/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ/–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –∫—É–ø–æ–Ω—ã/—Å–∫–∏–¥–∫–∏/–ø—Ä–æ–º–æ, –∫–∞–º–ø–∞–Ω–∏–∏/–∞–∫—Ü–∏–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
apps/advisor/
‚îú‚îÄ‚îÄ models.py          # AdvisorSession, AdvisorMessage
‚îú‚îÄ‚îÄ views.py           # –ß–∞—Ç –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ qa_simple.py       # –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ LLM
‚îú‚îÄ‚îÄ urls.py            # URL –º–∞—Ä—à—Ä—É—Ç—ã
‚îú‚îÄ‚îÄ admin.py           # –ê–¥–º–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îî‚îÄ‚îÄ templates/advisor/ # –®–∞–±–ª–æ–Ω—ã —á–∞—Ç–∞
```

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ INSTALLED_APPS:
```python
# pos_system/settings.py
INSTALLED_APPS = [
    # ...
    'apps.advisor',
    # ...
]
```

### 2. URL –º–∞—Ä—à—Ä—É—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:
```python
# pos_system/urls.py
urlpatterns = [
    # ...
    path('advisor/', include('apps.nla.urls', namespace='advisor')),
    # ...
]
```

### 3. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:
```bash
python manage.py makemigrations advisor
python manage.py migrate
```

## üí¨ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–æ—Å—Ç—É–ø –∫ —á–∞—Ç—É:
1. **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** ‚Üí –±–ª–æ–∫ "AI –°–æ–≤–µ—Ç—á–∏–∫" ‚Üí "–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç"
2. **–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞**: `http://localhost:8000/advisor/chat/`

### –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:
```
‚úÖ "–°–∫–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤?"
   ‚Üí üßæ –ù–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è: **1**.

‚úÖ "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?"
   ‚Üí üë• –í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ: **10**.

‚úÖ "–°–∫–æ–ª—å–∫–æ –≤—ã–¥–∞–Ω–æ –∫—É–ø–æ–Ω–æ–≤ —Å–µ–≥–æ–¥–Ω—è?"
   ‚Üí üéüÔ∏è –í—ã–¥–∞—á –∫—É–ø–æ–Ω–æ–≤ —Å–µ–≥–æ–¥–Ω—è: **6**.

‚úÖ "CR —Å–µ–≥–æ–¥–Ω—è?"
   ‚Üí üìä CR —Å–µ–≥–æ–¥–Ω—è: **50.0%** (3 –∏–∑ 6).
```

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –≤–æ–ø—Ä–æ—Å–æ–≤:

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–≤–µ—Ç–∞** –≤ `qa_simple.py`:
```python
def _answer_average_check(business, q: str, tz: str) -> Optional[QAResult]:
    if not re.search(r"—Å—Ä–µ–¥–Ω[^\n]*—á–µ–∫", q.lower()):
        return None
    
    start, end, period_label = _period_bounds(q, tz)
    avg = Redemption.objects.filter(
        coupon__campaign__business=business,
        redeemed_at__gte=start, 
        redeemed_at__lte=end
    ).aggregate(avg_amount=Avg('amount'))['avg_amount'] or 0
    
    return QAResult(text=f"üí∞ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ {period_label}: **{avg:.0f}** —Ç–≥.")
```

2. **–î–æ–±–∞–≤—å—Ç–µ –≤ —Å–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π**:
```python
ANSWER_FUNCS = [
    _answer_new_customers,
    _answer_issues,
    _answer_redeems,
    _answer_active_campaigns,
    _answer_total_customers,
    _answer_conversion_rate,
    _answer_average_check,  # –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
]
```

3. **–û–±–Ω–æ–≤–∏—Ç–µ –±—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏** –≤ `templates/advisor/chat.html`:
```html
{% for tip in "–°–∫–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤?,–°—Ä–µ–¥–Ω–∏–π —á–µ–∫ —Å–µ–≥–æ–¥–Ω—è?,CR —Å–µ–≥–æ–¥–Ω—è?".split:"," %}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
python manage.py test apps.advisor.tests.test_qa_simple
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
from apps.advisor.qa_simple import try_simple_qa
from apps.businesses.models import Business

business = Business.objects.first()
result = try_simple_qa(business, "–°–∫–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤?")
print(result.text if result else "No answer")
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:
- **–°–µ—Å—Å–∏–∏ —á–∞—Ç–∞**: `/admin/advisor/advisorsession/`
- **–°–æ–æ–±—â–µ–Ω–∏—è**: `/admin/advisor/advisormessage/`

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```python
# –°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
from apps.advisor.models import AdvisorMessage
messages = AdvisorMessage.objects.filter(role='user')
```

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM
```python
# –í views.py –ø–æ—Å–ª–µ –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:
if not quick:
    # –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ LLM (GPT, Claude, etc.)
    llm_response = call_llm_api(text, business_context)
    return llm_response
```

### 2. –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Web Speech API
const recognition = new webkitSpeechRecognition();
recognition.onresult = function(event) {
    document.getElementById('message-input').value = event.results[0][0].transcript;
};
```

### 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
- ROI –∫–∞–º–ø–∞–Ω–∏–π
- Retention rate
- LTV –∫–ª–∏–µ–Ω—Ç–æ–≤

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- `Django 5.2.5`
- `pytz` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–π–º–∑–æ–Ω–∞–º–∏
- `re` - —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã**: < 50ms
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –≥–æ—Ç–æ–≤–æ –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é Redis
- **–ò–Ω–¥–µ–∫—Å—ã –ë–î**: –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- CSRF –∑–∞—â–∏—Ç–∞
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Django
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã–±—Ä–∞–Ω –±–∏–∑–Ω–µ—Å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–π–º–∑–æ–Ω—ã

---

**AI –°–æ–≤–µ—Ç—á–∏–∫ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
