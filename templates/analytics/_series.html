<div class="bg-white p-6 rounded-lg shadow">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-900">üìà –î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –¥–Ω—è–º</h2>
        <div class="text-sm text-gray-500">
            {% if points_data %}
                {{ points_data|length }} –¥–Ω–µ–π
            {% else %}
                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
            {% endif %}
        </div>
    </div>
    
    {% if points_data %}
        <div class="relative" style="height: 300px;">
            <canvas id="metricsChart"></canvas>
        </div>
        
        <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
        <div class="flex justify-center space-x-6 mt-4 text-sm">
            <div class="flex items-center">
                <div class="w-3 h-3 bg-blue-500 rounded mr-2"></div>
                <span>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</span>
            </div>
            <div class="flex items-center">
                <div class="w-3 h-3 bg-green-500 rounded mr-2"></div>
                <span>–í—ã–¥–∞–Ω–æ</span>
            </div>
            <div class="flex items-center">
                <div class="w-3 h-3 bg-red-500 rounded mr-2"></div>
                <span>–ü–æ–≥–∞—à–µ–Ω–æ</span>
            </div>
        </div>
    {% else %}
        <div class="text-center py-12 text-gray-500">
            <div class="text-4xl mb-4">üìä</div>
            <h3 class="text-lg font-medium mb-2">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞</p>
        </div>
    {% endif %}
</div>

{% if points_data %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(function(){
    // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
    if (window.metricsChart) {
        window.metricsChart.destroy();
    }

    const points = {{ points }};
    const labels = points.map(p => {
        const date = new Date(p.date);
        return date.toLocaleDateString('ru-RU', {month: 'short', day: 'numeric'});
    });
    const views = points.map(p => p.view);
    const issues = points.map(p => p.issue);
    const redeems = points.map(p => p.redeem);

    const ctx = document.getElementById('metricsChart');
    window.metricsChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: '–ü—Ä–æ—Å–º–æ—Ç—Ä—ã',
                    data: views,
                    borderColor: 'rgb(59, 130, 246)',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.1
                },
                {
                    label: '–í—ã–¥–∞–Ω–æ',
                    data: issues,
                    borderColor: 'rgb(34, 197, 94)',
                    backgroundColor: 'rgba(34, 197, 94, 0.1)',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.1
                },
                {
                    label: '–ü–æ–≥–∞—à–µ–Ω–æ',
                    data: redeems,
                    borderColor: 'rgb(239, 68, 68)',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—É—é –ª–µ–≥–µ–Ω–¥—É
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        title: function(context) {
                            const date = new Date(points[context[0].dataIndex].date);
                            return date.toLocaleDateString('ru-RU', {
                                weekday: 'long',
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            });
                        }
                    }
                }
            },
            scales: {
                x: {
                    display: true,
                    title: {
                        display: true,
                        text: '–î–∞—Ç–∞'
                    },
                    ticks: {
                        maxTicksLimit: 10
                    }
                },
                y: {
                    display: true,
                    title: {
                        display: true,
                        text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'
                    },
                    beginAtZero: true
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            }
        }
    });
})();
</script>
{% endif %}
