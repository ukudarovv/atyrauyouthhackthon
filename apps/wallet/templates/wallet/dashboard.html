{% extends 'base.html' %}

{% block title %}Google Wallet - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∞–º–∏{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-semibold">üì± Google Wallet</h1>
            <p class="text-gray-600">{{ business.name }} - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∞–º–∏</p>
        </div>
        <div class="flex space-x-3">
            <a href="{% url 'wallet:settings' %}" class="px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
                ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </a>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="bg-white p-6 rounded-lg shadow">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                        <span class="text-blue-600 text-sm font-medium">üì±</span>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">–í—Å–µ–≥–æ –∫–∞—Ä—Ç</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ stats.total_passes }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                        <span class="text-green-600 text-sm font-medium">‚úÖ</span>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">–ê–∫—Ç–∏–≤–Ω—ã—Ö</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ stats.active_passes }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center">
                        <span class="text-gray-600 text-sm font-medium">‚è∞</span>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">–ò—Å—Ç–µ–∫—à–∏—Ö</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ stats.expired_passes }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                        <span class="text-purple-600 text-sm font-medium">üéØ</span>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</p>
                    <p class="text-2xl font-semibold text-gray-900">
                        {% if stats.total_passes > 0 %}
                            {{ stats.active_passes|floatformat:0 }}%
                        {% else %}
                            0%
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–ª–∞—Å—Å—ã –∫–∞—Ä—Ç -->
    {% if wallet_classes %}
    <div class="bg-white p-6 rounded-lg shadow mb-6">
        <h3 class="text-lg font-medium mb-4">üìã –ö–ª–∞—Å—Å—ã –∫–∞—Ä—Ç</h3>
        <div class="space-y-3">
            {% for wallet_class in wallet_classes %}
            <div class="flex items-center justify-between p-3 border rounded">
                <div>
                    <div class="font-medium">{{ wallet_class.name }}</div>
                    <div class="text-sm text-gray-500">
                        {{ wallet_class.get_platform_display }} ‚Ä¢ {{ wallet_class.review_status }}
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                        {% if wallet_class.review_status == 'APPROVED' %}bg-green-100 text-green-800
                        {% elif wallet_class.review_status == 'UNDER_REVIEW' %}bg-yellow-100 text-yellow-800
                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ wallet_class.review_status }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç -->
    <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b">
            <h3 class="text-lg font-medium">üì± Wallet –∫–∞—Ä—Ç—ã</h3>
        </div>

        {% if page_obj.object_list %}
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            –ö–∞—Ä—Ç–∞
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            –ö–ª–∏–µ–Ω—Ç
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            –ö–∞–º–ø–∞–Ω–∏—è
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            –°—Ç–∞—Ç—É—Å
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            –°–æ–∑–¥–∞–Ω–∞
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            –î–µ–π—Å—Ç–≤–∏—è
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for pass in page_obj.object_list %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-8 w-8">
                                    <div class="h-8 w-8 rounded-lg bg-gray-200 flex items-center justify-center">
                                        <span class="text-xs font-medium">üì±</span>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">{{ pass.title }}</div>
                                    <div class="text-sm text-gray-500">{{ pass.barcode_value }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">{{ pass.customer_phone }}</div>
                            {% if pass.customer_email %}
                            <div class="text-sm text-gray-500">{{ pass.customer_email }}</div>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% if pass.campaign %}
                            <div class="text-sm text-gray-900">{{ pass.campaign.name }}</div>
                            {% if pass.coupon %}
                            <div class="text-sm text-gray-500">–ö—É–ø–æ–Ω: {{ pass.coupon.code }}</div>
                            {% endif %}
                            {% else %}
                            <span class="text-gray-400">-</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                                {% if pass.status == 'active' %}bg-green-100 text-green-800
                                {% elif pass.status == 'expired' %}bg-gray-100 text-gray-800
                                {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                {{ pass.get_status_display }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ pass.created_at|date:"d.m.Y H:i" }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="{% url 'wallet:pass_detail' pass.pk %}" class="text-blue-600 hover:text-blue-900">
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if page_obj.has_other_pages %}
        <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200">
            <div class="flex-1 flex justify-between">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    –ù–∞–∑–∞–¥
                </a>
                {% endif %}
                
                <span class="text-sm text-gray-700">
                    –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
                </span>
                
                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    –í–ø–µ—Ä–µ–¥
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        {% else %}
        <div class="p-6 text-center">
            <div class="text-4xl mb-4">üì±</div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">–ü–æ–∫–∞ –Ω–µ—Ç Wallet –∫–∞—Ä—Ç</h3>
            <p class="text-gray-500 mb-4">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç—É –¥–ª—è –∫—É–ø–æ–Ω–∞ –∏–ª–∏ –∫–∞–º–ø–∞–Ω–∏–∏</p>
            <a href="/admin/coupons/coupon/" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫—É–ø–æ–Ω–∞–º
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
