{% extends 'base.html' %}

{% block title %}–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-semibold">üìß –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</h1>
            <p class="text-gray-600">{{ business.name }}</p>
        </div>
        <div class="flex space-x-3">
            <a href="{% url 'blasts:list' %}" class="px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
            </a>
        </div>
    </div>

    <form method="post" class="space-y-6">
        {% csrf_token %}
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="text-lg font-medium mb-4">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
                        –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏ *
                    </label>
                    <input type="text" 
                           id="name" 
                           name="name" 
                           required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ–µ—Ç–Ω—è—è –∞–∫—Ü–∏—è">
                </div>
                
                <div>
                    <label for="trigger" class="block text-sm font-medium text-gray-700 mb-1">
                        –¢–∏–ø –∑–∞–ø—É—Å–∫–∞
                    </label>
                    <select id="trigger" 
                            name="trigger"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        {% for trigger_code, trigger_name in trigger_choices %}
                        <option value="{{ trigger_code }}" {% if trigger_code == 'manual' %}selected{% endif %}>
                            {{ trigger_name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="mt-4">
                <label for="description" class="block text-sm font-medium text-gray-700 mb-1">
                    –û–ø–∏—Å–∞–Ω–∏–µ
                </label>
                <textarea id="description" 
                          name="description" 
                          rows="3"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏ —Ä–∞—Å—Å—ã–ª–∫–∏"></textarea>
            </div>
        </div>

        <!-- –ê—É–¥–∏—Ç–æ—Ä–∏—è -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="text-lg font-medium mb-4">üéØ –ê—É–¥–∏—Ç–æ—Ä–∏—è</h3>
            
            <div>
                <label for="segment_id" class="block text-sm font-medium text-gray-700 mb-1">
                    –°–µ–≥–º–µ–Ω—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
                </label>
                <select id="segment_id" 
                        name="segment_id"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã</option>
                    {% for segment in segments %}
                    <option value="{{ segment.id }}">
                        {{ segment.name }} ({{ segment.size_cached|default:"?" }} —á–µ–ª.)
                    </option>
                    {% endfor %}
                </select>
                <p class="text-xs text-gray-500 mt-1">
                    –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–≥–º–µ–Ω—Ç –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º
                </p>
            </div>
        </div>

        <!-- –ö–∞—Å–∫–∞–¥ –∫–∞–Ω–∞–ª–æ–≤ -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="text-lg font-medium mb-4">üì± –ö–∞—Å–∫–∞–¥ –∫–∞–Ω–∞–ª–æ–≤</h3>
            <p class="text-sm text-gray-600 mb-4">
                –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª—ã –∏ –ø–æ—Ä—è–¥–æ–∫ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∏–ª–∏ –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è, —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–π–¥–µ—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∫–∞–Ω–∞–ª—É.
            </p>
            
            <div id="cascade-channels" class="space-y-4">
                <!-- WhatsApp -->
                <div class="flex items-center space-x-4 p-3 border rounded">
                    <input type="checkbox" 
                           id="channel_whatsapp" 
                           name="channels" 
                           value="whatsapp"
                           checked
                           class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="channel_whatsapp" class="flex-1">
                        <span class="font-medium">üì± WhatsApp</span>
                        <span class="text-sm text-gray-500 block">–í—ã—Å–æ–∫–∏–π –æ—Ç–∫—Ä—ã–≤–∞–µ–º–æ—Å—Ç—å, –±—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm text-gray-600">Timeout:</label>
                        <input type="number" 
                               name="timeout_whatsapp" 
                               value="60"
                               min="0"
                               max="1440"
                               class="w-16 px-2 py-1 border border-gray-300 rounded text-center">
                        <span class="text-sm text-gray-500">–º–∏–Ω</span>
                    </div>
                </div>

                <!-- SMS -->
                <div class="flex items-center space-x-4 p-3 border rounded">
                    <input type="checkbox" 
                           id="channel_sms" 
                           name="channels" 
                           value="sms"
                           checked
                           class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="channel_sms" class="flex-1">
                        <span class="font-medium">üì± SMS</span>
                        <span class="text-sm text-gray-500 block">–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π, –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º</span>
                    </label>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm text-gray-600">Timeout:</label>
                        <input type="number" 
                               name="timeout_sms" 
                               value="180"
                               min="0"
                               max="1440"
                               class="w-16 px-2 py-1 border border-gray-300 rounded text-center">
                        <span class="text-sm text-gray-500">–º–∏–Ω</span>
                    </div>
                </div>

                <!-- Email -->
                <div class="flex items-center space-x-4 p-3 border rounded">
                    <input type="checkbox" 
                           id="channel_email" 
                           name="channels" 
                           value="email"
                           class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="channel_email" class="flex-1">
                        <span class="font-medium">üìß Email</span>
                        <span class="text-sm text-gray-500 block">–ü–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–∏–∑–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</span>
                    </label>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm text-gray-600">Timeout:</label>
                        <input type="number" 
                               name="timeout_email" 
                               value="0"
                               min="0"
                               max="1440"
                               class="w-16 px-2 py-1 border border-gray-300 rounded text-center">
                        <span class="text-sm text-gray-500">–º–∏–Ω</span>
                    </div>
                </div>

                <!-- Telegram -->
                <div class="flex items-center space-x-4 p-3 border rounded">
                    <input type="checkbox" 
                           id="channel_telegram" 
                           name="channels" 
                           value="telegram"
                           class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="channel_telegram" class="flex-1">
                        <span class="font-medium">üí¨ Telegram</span>
                        <span class="text-sm text-gray-500 block">–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞, –±–æ–≥–∞—Ç—ã–µ –º–µ–¥–∏–∞</span>
                    </label>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm text-gray-600">Timeout:</label>
                        <input type="number" 
                               name="timeout_telegram" 
                               value="30"
                               min="0"
                               max="1440"
                               class="w-16 px-2 py-1 border border-gray-300 rounded text-center">
                        <span class="text-sm text-gray-500">–º–∏–Ω</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±—é–¥–∂–µ—Ç -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="text-lg font-medium mb-4">‚è∞ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±—é–¥–∂–µ—Ç</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="schedule_at" class="block text-sm font-medium text-gray-700 mb-1">
                        –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –≤—Ä–µ–º—è
                    </label>
                    <input type="datetime-local" 
                           id="schedule_at" 
                           name="schedule_at"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-500 mt-1">
                        –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
                    </p>
                </div>
                
                <div>
                    <label for="budget_cap" class="block text-sm font-medium text-gray-700 mb-1">
                        –õ–∏–º–∏—Ç –±—é–¥–∂–µ—Ç–∞ ($)
                    </label>
                    <input type="number" 
                           id="budget_cap" 
                           name="budget_cap"
                           min="0"
                           step="0.01"
                           placeholder="100.00"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-500 mt-1">
                        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ–π —Ä–∞—Å—Å—ã–ª–∫–∏
                    </p>
                </div>
            </div>
            
            <div class="mt-4">
                <label for="max_cost_per_recipient" class="block text-sm font-medium text-gray-700 mb-1">
                    –õ–∏–º–∏—Ç –Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è ($)
                </label>
                <input type="number" 
                       id="max_cost_per_recipient" 
                       name="max_cost_per_recipient"
                       value="10"
                       min="0"
                       step="0.01"
                       class="w-full md:w-48 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <p class="text-xs text-gray-500 mt-1">
                    –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
                </p>
            </div>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="text-lg font-medium mb-4">‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –£—Å–ª–æ–≤–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–∞—Å–∫–∞–¥–∞
                    </label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" 
                                   name="stop_on_delivered_and_clicked" 
                                   checked
                                   class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –∫–ª–∏–∫–∞</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" 
                                   name="stop_on_redeemed"
                                   class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ –ø–æ–≥–∞—à–µ–Ω–∏—è –∫—É–ø–æ–Ω–∞</span>
                        </label>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –¢–∏—Ö–∏–µ —á–∞—Å—ã
                    </label>
                    <div class="flex items-center space-x-4">
                        <div>
                            <input type="time" 
                                   name="quiet_hours_start" 
                                   value="21:00"
                                   class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <span class="text-gray-500">‚Äî</span>
                        <div>
                            <input type="time" 
                                   name="quiet_hours_end" 
                                   value="09:00"
                                   class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">
                        –í—Ä–µ–º—è, –∫–æ–≥–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
                    </p>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="flex justify-end space-x-3">
            <a href="{% url 'blasts:list' %}" 
               class="px-6 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50">
                –û—Ç–º–µ–Ω–∞
            </a>
            <button type="submit" 
                    class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
            </button>
        </div>
    </form>
</div>

<script>
// –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–æ–ª—è timeout –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const channelCheckboxes = document.querySelectorAll('input[name="channels"]');
    
    channelCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const timeoutInput = document.querySelector(`input[name="timeout_${this.value}"]`);
            if (timeoutInput) {
                timeoutInput.disabled = !this.checked;
                if (!this.checked) {
                    timeoutInput.value = 0;
                }
            }
        });
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    channelCheckboxes.forEach(checkbox => {
        checkbox.dispatchEvent(new Event('change'));
    });
});
</script>
{% endblock %}
