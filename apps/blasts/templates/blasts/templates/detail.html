{% extends 'base.html' %}

{% block title %}{{ template.name }} - –î–µ—Ç–∞–ª–∏ —à–∞–±–ª–æ–Ω–∞{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-semibold">üìù {{ template.name }}</h1>
            <p class="text-gray-600">
                {% if template.channel == 'email' %}üìß Email
                {% elif template.channel == 'sms' %}üì± SMS
                {% elif template.channel == 'whatsapp' %}üì± WhatsApp
                {% elif template.channel == 'telegram' %}üí¨ Telegram
                {% elif template.channel == 'instagram' %}üì∏ Instagram
                {% elif template.channel == 'wallet' %}üì± Wallet
                {% else %}{{ template.get_channel_display }}{% endif %}
                ‚Ä¢ {{ template.locale|upper }}
                {% if template.is_active %}
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 ml-2">
                        ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω
                    </span>
                {% else %}
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 ml-2">
                        ‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω
                    </span>
                {% endif %}
            </p>
        </div>
        <div class="flex space-x-3">
            <a href="{% url 'blasts:template_list' %}" class="px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
            </a>
            <a href="{% url 'blasts:template_edit' template.pk %}" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <div class="lg:col-span-2 space-y-6">
            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-lg font-medium mb-4">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
                
                <div class="border rounded p-4 bg-gray-50">
                    {% if template.channel == 'email' and template.subject %}
                    <div class="mb-2"><strong>üìß Email</strong></div>
                    <div class="mb-2"><strong>–¢–µ–º–∞:</strong> {{ template.subject }}</div>
                    {% elif template.channel == 'sms' %}
                    <div class="mb-2"><strong>üì± SMS</strong></div>
                    {% elif template.channel == 'whatsapp' %}
                    <div class="mb-2"><strong>üì± WhatsApp</strong></div>
                    {% elif template.channel == 'telegram' %}
                    <div class="mb-2"><strong>üí¨ Telegram</strong></div>
                    {% endif %}
                    
                    <div class="whitespace-pre-wrap">{{ template.body_text }}</div>
                    
                    {% if template.channel == 'email' and template.body_html %}
                    <div class="mt-4 pt-4 border-t"><strong>HTML –≤–µ—Ä—Å–∏—è:</strong></div>
                    <div class="mt-2 p-3 border rounded bg-white">{{ template.body_html|safe }}</div>
                    {% endif %}
                </div>
                
                <div class="mt-4 text-sm text-gray-500">
                    –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞: {{ template.body_text|length }} —Å–∏–º–≤–æ–ª–æ–≤
                    {% if template.channel == 'sms' %}
                        {% if template.body_text|length > 160 %}
                            <span class="text-red-600 font-medium">(–ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç SMS: 160)</span>
                        {% else %}
                            <span class="text-green-600">(–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞ SMS)</span>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <!-- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-lg font-medium mb-4">üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ</h3>
                
                {% if template.variables %}
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    {% for variable in template.variables %}
                    <div class="p-3 border rounded bg-blue-50">
                        <code class="text-sm font-mono text-blue-600">{{{{ variable }}}}</code>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500">–í —ç—Ç–æ–º —à–∞–±–ª–æ–Ω–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ</p>
                {% endif %}
                
                <div class="mt-4">
                    <h4 class="text-sm font-medium text-gray-700 mb-2">–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                        <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded font-mono">customer_first_name</span>
                        <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded font-mono">customer_phone</span>
                        <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded font-mono">business_name</span>
                        <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded font-mono">coupon_code</span>
                        <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded font-mono">coupon_expires_at</span>
                        <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded font-mono">blast_name</span>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-lg font-medium mb-4">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-blue-600">{{ template.usage_count|default:0 }}</div>
                        <div class="text-sm text-gray-500">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –≤ —Ä–∞—Å—Å—ã–ª–∫–∞—Ö</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-green-600">{{ template.delivery_rate|default:0|floatformat:1 }}%</div>
                        <div class="text-sm text-gray-500">–î–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-purple-600">{{ template.click_rate|default:0|floatformat:1 }}%</div>
                        <div class="text-sm text-gray-500">–ö–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å</div>
                    </div>
                </div>
                
                {% if template.usage_count > 0 %}
                <div class="mt-6">
                    <h4 class="text-sm font-medium text-gray-700 mb-3">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏ —Å —ç—Ç–∏–º —à–∞–±–ª–æ–Ω–æ–º:</h4>
                    <!-- –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ä–∞—Å—Å—ã–ª–æ–∫ -->
                    <p class="text-sm text-gray-500">–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="space-y-6">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à–∞–±–ª–æ–Ω–µ -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-lg font-medium mb-4">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                
                <dl class="space-y-3">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">–ö–∞–Ω–∞–ª</dt>
                        <dd class="text-sm text-gray-900">
                            {% if template.channel == 'email' %}üìß Email
                            {% elif template.channel == 'sms' %}üì± SMS
                            {% elif template.channel == 'whatsapp' %}üì± WhatsApp
                            {% elif template.channel == 'telegram' %}üí¨ Telegram
                            {% elif template.channel == 'instagram' %}üì∏ Instagram
                            {% elif template.channel == 'wallet' %}üì± Wallet
                            {% else %}{{ template.get_channel_display }}{% endif %}
                        </dd>
                    </div>
                    
                    <div>
                        <dt class="text-sm font-medium text-gray-500">–Ø–∑—ã–∫</dt>
                        <dd class="text-sm text-gray-900">
                            {% if template.locale == 'ru' %}üá∑üá∫ –†—É—Å—Å–∫–∏–π
                            {% elif template.locale == 'kz' %}üá∞üáø –ö–∞–∑–∞—Ö—Å–∫–∏–π
                            {% elif template.locale == 'en' %}üá∫üá∏ English
                            {% else %}{{ template.locale|upper }}{% endif %}
                        </dd>
                    </div>
                    
                    <div>
                        <dt class="text-sm font-medium text-gray-500">–°—Ç–∞—Ç—É—Å</dt>
                        <dd class="text-sm text-gray-900">
                            {% if template.is_active %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω
                                </span>
                            {% else %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                    ‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω
                                </span>
                            {% endif %}
                        </dd>
                    </div>
                    
                    {% if template.a_b_bucket %}
                    <div>
                        <dt class="text-sm font-medium text-gray-500">A/B —Ç–µ—Å—Ç</dt>
                        <dd class="text-sm text-gray-900">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                                üß™ –í–∞—Ä–∏–∞–Ω—Ç {{ template.a_b_bucket }}
                            </span>
                        </dd>
                    </div>
                    {% endif %}
                    
                    <div>
                        <dt class="text-sm font-medium text-gray-500">–°–æ–∑–¥–∞–Ω</dt>
                        <dd class="text-sm text-gray-900">{{ template.created_at|date:"d.m.Y H:i" }}</dd>
                    </div>
                    
                    <div>
                        <dt class="text-sm font-medium text-gray-500">–û–±–Ω–æ–≤–ª–µ–Ω</dt>
                        <dd class="text-sm text-gray-900">{{ template.updated_at|date:"d.m.Y H:i" }}</dd>
                    </div>
                </dl>
            </div>

            <!-- –î–µ–π—Å—Ç–≤–∏—è -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-lg font-medium mb-4">‚ö° –î–µ–π—Å—Ç–≤–∏—è</h3>
                
                <div class="space-y-3">
                    <a href="{% url 'blasts:template_edit' template.pk %}" 
                       class="block w-full text-center px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω
                    </a>
                    
                    <button onclick="duplicateTemplate()" 
                            class="block w-full text-center px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
                        üìÑ –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω
                    </button>
                    
                    <button onclick="testTemplate()" 
                            class="block w-full text-center px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
                        üì® –¢–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
                    </button>
                    
                    {% if not template.is_active %}
                    <form method="post" action="{% url 'blasts:template_activate' template.pk %}">
                        {% csrf_token %}
                        <button type="submit" 
                                class="block w-full text-center px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                            ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </form>
                    {% else %}
                    <form method="post" action="{% url 'blasts:template_deactivate' template.pk %}">
                        {% csrf_token %}
                        <button type="submit" 
                                class="block w-full text-center px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700">
                            ‚è∏Ô∏è –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>

            <!-- –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-lg font-medium mb-4">üìß –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏</h3>
                
                {% if template.usage_count > 0 %}
                <p class="text-sm text-gray-600 mb-3">
                    –≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ {{ template.usage_count }} —Ä–∞—Å—Å—ã–ª–∫–∞—Ö
                </p>
                <!-- –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Å—ã–ª–æ–∫ -->
                <div class="text-center">
                    <button class="text-sm text-blue-600 hover:text-blue-800">
                        –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ä–∞—Å—Å—ã–ª–∫–∏
                    </button>
                </div>
                {% else %}
                <p class="text-sm text-gray-500">
                    –≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –µ—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ —Ä–∞—Å—Å—ã–ª–∫–∞—Ö
                </p>
                <div class="mt-3">
                    <a href="{% url 'blasts:create' %}" 
                       class="text-sm text-blue-600 hover:text-blue-800">
                        –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É —Å —ç—Ç–∏–º —à–∞–±–ª–æ–Ω–æ–º
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
function duplicateTemplate() {
    if (confirm('–°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é —ç—Ç–æ–≥–æ —à–∞–±–ª–æ–Ω–∞?')) {
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
        alert('–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

function testTemplate() {
    const phone = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏:');
    if (phone) {
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
        alert('–¢–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}
</script>
{% endblock %}
