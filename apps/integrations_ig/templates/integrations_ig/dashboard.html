{% extends 'base.html' %}

{% block title %}Instagram - {{ ig_account.username }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="flex items-center justify-between mb-8">
        <div class="flex items-center space-x-4">
            {% if ig_account.profile_picture_url %}
                <img src="{{ ig_account.profile_picture_url }}" 
                     alt="@{{ ig_account.username }}" 
                     class="w-16 h-16 rounded-full border-2 border-purple-200">
            {% else %}
                <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center">
                    <span class="text-white text-xl font-bold">{{ ig_account.username|first|upper }}</span>
                </div>
            {% endif %}
            
            <div>
                <h1 class="text-2xl font-bold text-gray-900">@{{ ig_account.username }}</h1>
                <div class="flex items-center space-x-4 text-sm text-gray-600">
                    <span>üë• {{ ig_account.followers_count|floatformat:0 }} –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span>
                    <span class="flex items-center">
                        {% if ig_account.status == 'connected' %}
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            –ü–æ–¥–∫–ª—é—á–µ–Ω
                        {% elif ig_account.status == 'expired' %}
                            <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                            –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫
                        {% else %}
                            <span class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></span>
                            {{ ig_account.get_status_display }}
                        {% endif %}
                    </span>
                    {% if ig_account.needs_refresh %}
                        <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">
                            ‚ö†Ô∏è –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ {{ ig_account.days_until_expiry }} –¥–Ω.
                        </span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="flex space-x-3">
            <a href="{% url 'integrations_ig:media_library' %}" 
               class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                üìö –ú–µ–¥–∏–∞—Ç–µ–∫–∞
            </a>
            <a href="#" 
               class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                ‚ûï –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç
            </a>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <!-- –ú–µ–¥–∏–∞ -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">–í—Å–µ–≥–æ –º–µ–¥–∏–∞</p>
                    <p class="text-2xl font-bold text-gray-900">{{ media_stats.total }}</p>
                </div>
                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
            </div>
            <div class="mt-4 flex space-x-4 text-sm">
                <span class="text-green-600">üì§ {{ media_stats.published }}</span>
                <span class="text-blue-600">‚è∞ {{ media_stats.scheduled }}</span>
                <span class="text-gray-500">üìù {{ media_stats.drafts }}</span>
            </div>
        </div>

        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</p>
                    <p class="text-2xl font-bold text-gray-900">{{ comment_stats.total }}</p>
                </div>
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                </div>
            </div>
            <div class="mt-4 flex space-x-4 text-sm">
                {% if comment_stats.toxic > 0 %}
                    <span class="text-red-600">üö´ {{ comment_stats.toxic }} —Ç–æ–∫—Å.</span>
                {% endif %}
                {% if comment_stats.hidden > 0 %}
                    <span class="text-yellow-600">üëÅÔ∏è {{ comment_stats.hidden }} —Å–∫—Ä—ã—Ç–æ</span>
                {% endif %}
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">–°–æ–æ–±—â–µ–Ω–∏—è</p>
                    <p class="text-2xl font-bold text-gray-900">{{ dm_stats.total }}</p>
                </div>
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                    </svg>
                </div>
            </div>
            <div class="mt-4 flex space-x-4 text-sm">
                {% if dm_stats.unread > 0 %}
                    <span class="text-red-600">üì¨ {{ dm_stats.unread }} –Ω–æ–≤—ã—Ö</span>
                {% endif %}
                <span class="text-blue-600">ü§ñ {{ dm_stats.bot_responses }} –±–æ—Ç</span>
            </div>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</p>
                    <div class="mt-2 space-y-1">
                        <div class="flex items-center text-sm">
                            {% if ig_account.auto_publish_enabled %}
                                <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                <span class="text-green-600">–ê–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è</span>
                            {% else %}
                                <span class="w-2 h-2 bg-gray-400 rounded-full mr-2"></span>
                                <span class="text-gray-500">–ê–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è</span>
                            {% endif %}
                        </div>
                        <div class="flex items-center text-sm">
                            {% if ig_account.dm_bot_enabled %}
                                <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                <span class="text-green-600">DM-–±–æ—Ç</span>
                            {% else %}
                                <span class="w-2 h-2 bg-gray-400 rounded-full mr-2"></span>
                                <span class="text-gray-500">DM-–±–æ—Ç</span>
                            {% endif %}
                        </div>
                        <div class="flex items-center text-sm">
                            {% if ig_account.comment_moderation_enabled %}
                                <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                <span class="text-green-600">–ú–æ–¥–µ—Ä–∞—Ü–∏—è</span>
                            {% else %}
                                <span class="w-2 h-2 bg-gray-400 rounded-full mr-2"></span>
                                <span class="text-gray-500">–ú–æ–¥–µ—Ä–∞—Ü–∏—è</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –º–µ–¥–∏–∞ -->
    {% if recent_media %}
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">üì∏ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</h2>
                    <a href="{% url 'integrations_ig:media_library' %}" 
                       class="text-purple-600 hover:text-purple-800 text-sm font-medium">
                        –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ‚Üí
                    </a>
                </div>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for media in recent_media %}
                        <div class="border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow">
                            <!-- –ü—Ä–µ–≤—å—é –º–µ–¥–∏–∞ -->
                            <div class="aspect-square bg-gray-100 relative">
                                {% if media.thumbnail_url %}
                                    <img src="{{ media.thumbnail_url }}" 
                                         alt="Media preview" 
                                         class="w-full h-full object-cover">
                                {% elif media.media_url %}
                                    <img src="{{ media.media_url }}" 
                                         alt="Media preview" 
                                         class="w-full h-full object-cover">
                                {% else %}
                                    <div class="w-full h-full flex items-center justify-center">
                                        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                {% endif %}
                                
                                <!-- –¢–∏–ø –º–µ–¥–∏–∞ -->
                                <div class="absolute top-2 left-2">
                                    {% if media.media_type == 'reel' %}
                                        <span class="px-2 py-1 bg-purple-600 text-white text-xs rounded">REEL</span>
                                    {% elif media.media_type == 'carousel' %}
                                        <span class="px-2 py-1 bg-blue-600 text-white text-xs rounded">–ö–ê–†–£–°–ï–õ–¨</span>
                                    {% elif media.media_type == 'video' %}
                                        <span class="px-2 py-1 bg-green-600 text-white text-xs rounded">–í–ò–î–ï–û</span>
                                    {% endif %}
                                </div>
                                
                                <!-- –°—Ç–∞—Ç—É—Å -->
                                <div class="absolute top-2 right-2">
                                    {% if media.status == 'published' %}
                                        <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                                    {% elif media.status == 'scheduled' %}
                                        <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                                    {% elif media.status == 'failed' %}
                                        <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                                    {% else %}
                                        <span class="w-3 h-3 bg-gray-400 rounded-full"></span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                            <div class="p-4">
                                <p class="text-sm text-gray-800 line-clamp-2 mb-2">
                                    {% if media.caption %}
                                        {{ media.caption|truncatechars:80 }}
                                    {% else %}
                                        <span class="text-gray-500">(–±–µ–∑ –ø–æ–¥–ø–∏—Å–∏)</span>
                                    {% endif %}
                                </p>
                                
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span>{{ media.created_at|date:"d.m.Y H:i" }}</span>
                                    {% if media.engagement_rate > 0 %}
                                        <span class="text-green-600">{{ media.engagement_rate }}% ER</span>
                                    {% endif %}
                                </div>
                                
                                {% if media.status == 'published' and media.permalink %}
                                    <div class="mt-3">
                                        <a href="{{ media.permalink }}" 
                                           target="_blank"
                                           class="text-purple-600 hover:text-purple-800 text-sm font-medium">
                                            –°–º–æ—Ç—Ä–µ—Ç—å –≤ Instagram ‚Üí
                                        </a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% else %}
        <div class="bg-white rounded-lg shadow p-8 text-center">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">–ü–æ–∫–∞ –Ω–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–π</h3>
            <p class="text-gray-600 mb-4">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç –¥–ª—è Instagram</p>
            <a href="#" 
               class="inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                ‚ûï –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}
